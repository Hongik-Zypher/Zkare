# λΈ”λ΅μ²΄μΈ μ €μ¥ κµ¬μ΅° μƒμ„Έ μ„¤λ…

## π“ μ „μ²΄ μ €μ¥ μ•„ν‚¤ν…μ²

```
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚              λΈ”λ΅μ²΄μΈ (Ethereum Network)                 β”‚
β”‚                                                          β”‚
β”‚  EncryptedMedicalRecord μ»¨νΈλ™νΈ                         β”‚
β”‚  β”β”€ mapping(address => PatientInfo)                     β”‚
β”‚  β””β”€ mapping(address => mapping(uint256 => MedicalRecord))β”‚
β”‚                                                          β”‚
β”‚  [μ €μ¥λλ” λ°μ΄ν„°]                                      β”‚
β”‚  β€Ά ν™μ μ΄λ¦„ (ν‰λ¬Έ)                                     β”‚
β”‚  β€Ά IPFS CID                                             β”‚
β”‚  β€Ά λ°μ΄ν„° ν•΄μ‹ (SHA-256)                                β”‚
β”‚  β€Ά μ•”νΈν™”λ AES ν‚¤ (μμ‚¬μ©, ν™μμ©)                     β”‚
β”‚  β€Ά νƒ€μ„μ¤νƒ¬ν”„                                           β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
                          β†• (CIDλ΅ μ—°κ²°)
β”β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
β”‚              IPFS Network (Pinata)                      β”‚
β”‚                                                          β”‚
β”‚  [μ‹¤μ  μ•”νΈν™”λ λ°μ΄ν„° μ €μ¥]                            β”‚
β”‚  β€Ά AES-256-GCMμΌλ΅ μ•”νΈν™”λ κΈ°λ³Έμ •λ³΄/μ§„λ£κΈ°λ΅          β”‚
β”‚  β€Ά Base64λ΅ μΈμ½”λ”©λ λ¬Έμμ—΄                            β”‚
β””β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”€β”
```

---

## π” λΈ”λ΅μ²΄μΈ μ €μ¥ κµ¬μ΅°

### 1. PatientInfo κµ¬μ΅°μ²΄ (ν™μ κΈ°λ³Έμ •λ³΄)

**μ €μ¥ μ„μΉ**: `mapping(address => PatientInfo) private patientInfo`

```solidity
struct PatientInfo {
    string name;                    // ν™μ μ΄λ¦„ (ν‰λ¬Έ, λΈ”λ΅μ²΄μΈμ— μ €μ¥)
    string ipfsCid;                 // IPFS CID (μ•”νΈν™”λ λ°μ΄ν„° μ„μΉ)
    string dataHash;                // SHA-256 ν•΄μ‹ (λ¬΄κ²°μ„± κ²€μ¦)
    string encryptedDoctorKey;      // RSAλ΅ μ•”νΈν™”λ AES ν‚¤ (μμ‚¬μ©)
    string encryptedPatientKey;     // RSAλ΅ μ•”νΈν™”λ AES ν‚¤ (ν™μμ©)
    uint256 timestamp;              // λ“±λ΅ μ‹κ°„
    bool isRegistered;              // λ“±λ΅ μ—¬λ¶€ ν”λκ·Έ
}
```

**μ‹¤μ  μ €μ¥ μμ‹:**

```
patientAddress: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8

patientInfo[0x7099...] = {
    name: "ν™κΈΈλ™",                           // β† λΈ”λ΅μ²΄μΈμ— ν‰λ¬ΈμΌλ΅ μ €μ¥
    ipfsCid: "QmXxxxyyyzzz123456789",       // β† IPFS μ„μΉ (λΈ”λ΅μ²΄μΈ)
    dataHash: "a3b5c7d9e1f2g3h4i5j6...",   // β† ν•΄μ‹ (λΈ”λ΅μ²΄μΈ)
    encryptedDoctorKey: "MIIBIjANBgkqh...", // β† RSA μ•”νΈν™”λ AES ν‚¤ (λΈ”λ΅μ²΄μΈ)
    encryptedPatientKey: "MIIBIjANBgkqh...", // β† RSA μ•”νΈν™”λ AES ν‚¤ (λΈ”λ΅μ²΄μΈ)
    timestamp: 1701234567,                  // β† λΈ”λ΅ νƒ€μ„μ¤νƒ¬ν”„
    isRegistered: true
}
```

---

### 2. MedicalRecord κµ¬μ΅°μ²΄ (μλ£ κΈ°λ΅)

**μ €μ¥ μ„μΉ**: `mapping(address => mapping(uint256 => MedicalRecord)) private medicalRecords`

```solidity
struct MedicalRecord {
    string ipfsCid;                 // IPFS CID (μ•”νΈν™”λ λ°μ΄ν„° μ„μΉ)
    string dataHash;                // SHA-256 ν•΄μ‹ (λ¬΄κ²°μ„± κ²€μ¦)
    string encryptedDoctorKey;      // RSAλ΅ μ•”νΈν™”λ AES ν‚¤ (μμ‚¬μ©)
    string encryptedPatientKey;     // RSAλ΅ μ•”νΈν™”λ AES ν‚¤ (ν™μμ©)
    address doctor;                 // μ§„λ£ν• μμ‚¬ μ£Όμ†
    uint256 timestamp;              // κΈ°λ΅ μƒμ„± μ‹κ°„
}
```

**μ‹¤μ  μ €μ¥ μμ‹:**

```
patientAddress: 0x70997970C51812dc3A010C7d01b50e0d17dc79C8
recordId: 0

medicalRecords[0x7099...][0] = {
    ipfsCid: "QmAbcdef123456789",           // β† IPFS μ„μΉ (λΈ”λ΅μ²΄μΈ)
    dataHash: "1a2b3c4d5e6f7a8b9c...",     // β† ν•΄μ‹ (λΈ”λ΅μ²΄μΈ)
    encryptedDoctorKey: "MIIBIjANBgkqh...", // β† RSA μ•”νΈν™”λ AES ν‚¤ (λΈ”λ΅μ²΄μΈ)
    encryptedPatientKey: "MIIBIjANBgkqh...", // β† RSA μ•”νΈν™”λ AES ν‚¤ (λΈ”λ΅μ²΄μΈ)
    doctor: 0xf39Fd6e51aad88F6F4ce6aB8827279cffFb92266, // β† μμ‚¬ μ£Όμ†
    timestamp: 1701234567                   // β† λΈ”λ΅ νƒ€μ„μ¤νƒ¬ν”„
}
```

---

## π IPFSμ— μ €μ¥λλ” λ°μ΄ν„° κµ¬μ΅°

### 1. ν™μ κΈ°λ³Έμ •λ³΄ (IPFS)

**IPFS CID**: `QmXxxxyyyzzz123456789` (λΈ”λ΅μ²΄μΈμ— μ €μ¥)

**μ €μ¥λ JSON κµ¬μ΅°:**

```json
{
  "data": "eyJlbmNyeXB0ZWRSZWNvcmQiOiJhYjEyMzQ1Njc4OTBhYmNkZWYxMjM0NTY3ODkwYWJjZGVmMTIzNDU2Nzg5MGFiY2RlZjEyMzQ1Njc4OTBhYmNkZWYxMjM0NTY3ODkwYWJjZGVmMTIzNDU2Nzg5MCIsIml2IjoieHl6YWJjZGVmMTIzNDU2Nzg5MCI="
}
```

**μ‹¤μ  λ‚΄μ© (λ³µνΈν™” ν›„):**

```json
{
  "encryptedRecord": "ab1234567890abcdef1234567890abcdef...", // Base64 μ•”νΈν™”λ λ°μ΄ν„°
  "iv": "xyzabcdef1234567890" // μ΄κΈ°ν™” λ²΅ν„°
}
```

**μ›λ³Έ λ°μ΄ν„° (λ³µνΈν™” ν›„):**

```json
{
  "height": "175",
  "weight": "70",
  "bloodType": "A",
  "ssn": "123456-1234567"
}
```

---

### 2. μλ£ κΈ°λ΅ (IPFS)

**IPFS CID**: `QmAbcdef123456789` (λΈ”λ΅μ²΄μΈμ— μ €μ¥)

**μ €μ¥λ JSON κµ¬μ΅°:**

```json
{
  "data": "eyJlbmNyeXB0ZWRSZWNvcmQiOiJkZWY0NTY3ODkwYWJjZGVmMTIzNDU2Nzg5MGFiY2RlZjEyMzQ1Njc4OTBhYmNkZWYxMjM0NTY3ODkwYWJjZGVmMTIzNDU2Nzg5MCIsIml2IjoiYWJjZGVmMTIzNDU2Nzg5MCI="
}
```

**μ›λ³Έ λ°μ΄ν„° (λ³µνΈν™” ν›„):**

```json
{
  "symptoms": "λ‘ν†µ, λ°μ—΄, μΈν›„ν†µ",
  "diagnosis": "κ°κΈ°",
  "treatment": "μ¶©λ¶„ν• ν΄μ‹",
  "prescription": "ν•΄μ—΄μ , μ§„ν†µμ ",
  "notes": "3μΌ ν›„ μ¬λ°©λ¬Έ",
  "date": "2025-10-29T10:30:00.000Z"
}
```

---

## π”„ λ°μ΄ν„° μ €μ¥ λ° μ΅°ν ν”λ΅μ°

### **μ €μ¥ ν”λ΅μ° (ν™μ λ“±λ΅)**

```
1. ν”„λ΅ νΈμ—”λ“
   β””β”€> κΈ°λ³Έμ •λ³΄: { height, weight, bloodType, ssn }

2. μ•”νΈν™” (λΈλΌμ°μ €)
   β”β”€> AES-256-GCMμΌλ΅ μ•”νΈν™”
   β””β”€> AES ν‚¤λ¥Ό RSAλ΅ μ•”νΈν™” (μμ‚¬μ©, ν™μμ© κ°κ°)

3. IPFS μ—…λ΅λ“
   β”β”€> μ•”νΈν™”λ λ°μ΄ν„° JSON.stringify
   β”β”€> Pinataμ— μ—…λ΅λ“
   β”β”€> CID λ°ν™: "QmXxxxyyyzzz..."
   β””β”€> SHA-256 ν•΄μ‹ κ³„μ‚°: "a3b5c7d9..."

4. λΈ”λ΅μ²΄μΈ μ €μ¥
   β””β”€> registerPatient(
         patientAddress,
         name,              // β† ν‰λ¬ΈμΌλ΅ λΈ”λ΅μ²΄μΈ μ €μ¥
         cid,               // β† IPFS μ„μΉλ§ μ €μ¥
         hash,              // β† ν•΄μ‹λ§ μ €μ¥
         encryptedDoctorKey, // β† AES ν‚¤ μ €μ¥
         encryptedPatientKey // β† AES ν‚¤ μ €μ¥
       )
```

### **μ΅°ν ν”λ΅μ° (ν™μ μ •λ³΄ μ΅°ν)**

```
1. λΈ”λ΅μ²΄μΈ μ΅°ν
   β””β”€> getPatientInfo(patientAddress)
       β””β”€> λ°ν™: { name, ipfsCid, dataHash, encryptedDoctorKey, ... }

2. IPFS μ΅°ν
   β””β”€> CIDλ΅ IPFS Gatewayμ—μ„ λ°μ΄ν„° λ‹¤μ΄λ΅λ“
       β””β”€> { "data": "eyJlbmNye..." }

3. λ¬΄κ²°μ„± κ²€μ¦
   β””β”€> λ‹¤μ΄λ΅λ“ν• λ°μ΄ν„°μ SHA-256 ν•΄μ‹ κ³„μ‚°
   β””β”€> λΈ”λ΅μ²΄μΈμ hashμ™€ λΉ„κµ
   β””β”€> μΌμΉν•μ§€ μ•μΌλ©΄ μ—λ¬ (λ°μ΄ν„° λ³€μ΅° κ°€λ¥μ„±)

4. λ³µνΈν™”
   β”β”€> RSA κ°μΈν‚¤λ΅ encryptedDoctorKey λ³µνΈν™” β†’ AES ν‚¤ νλ“
   β””β”€> AES ν‚¤λ΅ μ•”νΈν™”λ λ°μ΄ν„° λ³µνΈν™”
       β””β”€> μ›λ³Έ κΈ°λ³Έμ •λ³΄ νλ“: { height, weight, bloodType, ssn }
```

---

## π“ λ°μ΄ν„° μ €μ¥ μ„μΉ λΉ„κµν‘

| λ°μ΄ν„° ν•­λ©                                 | λΈ”λ΅μ²΄μΈ μ €μ¥ | IPFS μ €μ¥ | μ•”νΈν™” μ—¬λ¶€  |
| ------------------------------------------- | ------------- | --------- | ------------ | --- |
| calend                                      | ν™μ μ΄λ¦„     | β… ν‰λ¬Έ   | β           | β  |
| IPFS CID                                    | β…            | β        | β           |
| λ°μ΄ν„° ν•΄μ‹                                 | β…            | β        | β           |
| μ•”νΈν™”λ AES ν‚¤ (μμ‚¬μ©)                    | β…            | β        | β… (RSA)     |
| μ•”νΈν™”λ AES ν‚¤ (ν™μμ©)                    | β…            | β        | β… (RSA)     |
| νƒ€μ„μ¤νƒ¬ν”„                                  | β…            | β        | β           |
| **κΈ°λ³Έμ •λ³΄** (ν‚¤, λΈλ¬΄κ², νμ•΅ν•, μ£Όλ―Όλ²νΈ) | β            | β…        | β… (AES-256) |
| **μ§„λ£κΈ°λ΅** (μ¦μƒ, μ§„λ‹¨, μ²λ°© λ“±)          | β            | β…        | β… (AES-256) |
| μμ‚¬ μ£Όμ†                                   | β…            | β        | β           |

---

## π’΅ μ£Όμ” ν¬μΈνΈ

### 1. **λΈ”λ΅μ²΄μΈμ—λ” λ©”νƒ€λ°μ΄ν„°λ§ μ €μ¥**

- μ‹¤μ  μλ£ λ°μ΄ν„°λ” IPFSμ— μ €μ¥
- λΈ”λ΅μ²΄μΈμ—λ” IPFS μ„μΉ(CID)μ™€ ν•΄μ‹λ§ μ €μ¥
- **κ°€μ¤λΉ„ μ κ°**: λ€μ©λ‰ λ°μ΄ν„°λ¥Ό λΈ”λ΅μ²΄μΈμ— μ €μ¥ν•μ§€ μ•μ

### 2. **μ΄μ¤‘ μ•”νΈν™” κµ¬μ΅°**

- **1μ°¨**: AES-256-GCMμΌλ΅ λ°μ΄ν„° μ•”νΈν™” (λΉ λ¥Έ μ•”νΈν™”/λ³µνΈν™”)
- **2μ°¨**: AES ν‚¤λ¥Ό RSA-OAEPλ΅ μ•”νΈν™” (μμ‚¬μ©, ν™μμ© κ°κ°)
- κ° μ‚¬μ©μλ” μμ‹ μ κ°μΈν‚¤λ΅λ§ AES ν‚¤λ¥Ό λ³µνΈν™” κ°€λ¥

### 3. **λ¬΄κ²°μ„± κ²€μ¦**

- λΈ”λ΅μ²΄μΈμ— μ €μ¥λ ν•΄μ‹μ™€ IPFSμ—μ„ λ‹¤μ΄λ΅λ“ν• λ°μ΄ν„°μ ν•΄μ‹ λΉ„κµ
- ν•΄μ‹κ°€ λ‹¤λ¥΄λ©΄ λ°μ΄ν„°κ°€ λ³€μ΅°λμ—κ±°λ‚ μ†μƒλμ—μ„ κ°€λ¥μ„±
- **λ°μ΄ν„° μ‹ λΆ°μ„± λ³΄μ¥**

### 4. **μ ‘κ·Ό μ μ–΄**

- `encryptedDoctorKey`: μμ‚¬λ§ λ³µνΈν™” κ°€λ¥ (μμ‚¬ RSA κ°μΈν‚¤ ν•„μ”)
- `encryptedPatientKey`: ν™μλ§ λ³µνΈν™” κ°€λ¥ (ν™μ RSA κ°μΈν‚¤ ν•„μ”)
- λΈ”λ΅μ²΄μΈμ `isDoctor` κ²€μ¦μΌλ΅ μ ‘κ·Ό κ¶ν• μ μ–΄

### 5. **μκµ¬ λ³΄κ΄€**

- IPFS ν•€λ‹ μ„λΉ„μ¤(Pinata)λ΅ λ°μ΄ν„° μκµ¬ λ³΄κ΄€
- λΈ”λ΅μ²΄μΈμ€ μκµ¬μ μ΄λ―€λ΅ CIDμ™€ ν•΄μ‹λ” μκµ¬ λ³΄κ΄€
- **λ°μ΄ν„° μ†μ‹¤ λ°©μ§€**

---

## π” μ‹¤μ  λΈ”λ΅μ²΄μΈ νΈλμ­μ… μμ‹

### registerPatient νΈλμ­μ…:

```javascript
// νΈλμ­μ… λ°μ΄ν„°
{
  "to": "0xB7f8BC63BbcaD18155201308C8f3540b07f84F5e", // μ»¨νΈλ™νΈ μ£Όμ†
  "function": "registerPatient",
  "parameters": {
    "_patient": "0x70997970C51812dc3A010C7d01b50e0d17dc79C8",
    "_name": "ν™κΈΈλ™",                                    // β† ν‰λ¬Έ μ €μ¥
    "_ipfsCid": "QmXxxxyyyzzz123456789",                // β† IPFS μ„μΉ
    "_dataHash": "0xa3b5c7d9e1f2g3h4i5j6...",           // β† ν•΄μ‹
    "_encryptedDoctorKey": "MIIBIjANBgkqhkiG9w...",     // β† RSA μ•”νΈν™”
    "_encryptedPatientKey": "MIIBIjANBgkqhkiG9w..."     // β† RSA μ•”νΈν™”
  }
}
```

### λΈ”λ΅μ²΄μΈμ— μ €μ¥λ μƒνƒ:

```solidity
// Storage μ¬λ΅― (κ°„μ†ν™”λ ν‘ν„)
patientInfo[0x7099...] = Storage {
    slot 0: name = "ν™κΈΈλ™"
    slot 1: ipfsCid = "QmXxxxyyyzzz123456789"  // μ•½ 46 bytes
    slot 2: dataHash = "0xa3b5c7d9..."          // 66 bytes
    slot 3: encryptedDoctorKey = "MIIBIj..."    // μ•½ 400 bytes
    slot 4: encryptedPatientKey = "MIIBIj..."   // μ•½ 400 bytes
    slot 5: timestamp = 1701234567              // 32 bytes
    slot 6: isRegistered = true                 // 1 byte
}

// μ΄ λΈ”λ΅μ²΄μΈ μ €μ¥ ν¬κΈ°: μ•½ ~950 bytes
// μ‹¤μ  μλ£ λ°μ΄ν„° (IPFS): μ•½ ~500 bytes (μ•”νΈν™”λ μƒνƒ)
// κ°€μ¤λΉ„ μ κ°: μ•½ 99% (ν° λ°μ΄ν„°λ” IPFSμ— μ €μ¥)
```

---

## π“ μ”μ•½

### **λΈ”λ΅μ²΄μΈμ— μ €μ¥λλ” κ²ƒ:**

1. β… ν™μ μ΄λ¦„ (ν‰λ¬Έ)
2. β… IPFS CID (μ•”νΈν™”λ λ°μ΄ν„° μ„μΉ)
3. β… λ°μ΄ν„° ν•΄μ‹ (λ¬΄κ²°μ„± κ²€μ¦)
4. β… μ•”νΈν™”λ AES ν‚¤ (μμ‚¬μ©, ν™μμ©)
5. β… νƒ€μ„μ¤νƒ¬ν”„
6. β… μμ‚¬ μ£Όμ† (μ§„λ£κΈ°λ΅λ§)

### **IPFSμ— μ €μ¥λλ” κ²ƒ:**

1. β… μ•”νΈν™”λ κΈ°λ³Έμ •λ³΄ (ν‚¤, λΈλ¬΄κ², νμ•΅ν•, μ£Όλ―Όλ²νΈ)
2. β… μ•”νΈν™”λ μ§„λ£κΈ°λ΅ (μ¦μƒ, μ§„λ‹¨, μ²λ°©, λ©”λ¨)

### **μ €μ¥λμ§€ μ•λ” κ²ƒ:**

1. β μ›λ³Έ μλ£ λ°μ΄ν„° (λΈ”λ΅μ²΄μΈμ—λ” μ €μ¥ μ• ν•¨)
2. β AES ν‚¤ (ν‰λ¬Έ, μ•”νΈν™”λ ν•νƒλ§ μ €μ¥)
3. β IV (Initialization Vector, IPFS λ°μ΄ν„°μ— ν¬ν•¨)

---

**μ΄ κµ¬μ΅°μ μ¥μ :**

- π€ κ°€μ¤λΉ„ μ κ° (99% μ΄μƒ)
- π” κ°•λ ¥ν• μ•”νΈν™” λ° μ ‘κ·Ό μ μ–΄
- β… λ°μ΄ν„° λ¬΄κ²°μ„± κ²€μ¦
- π λ¶„μ‚° μ €μ¥ (IPFS)
- π”’ ν”„λΌμ΄λ²„μ‹ λ³΄νΈ
