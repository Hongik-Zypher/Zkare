# ZKare 사용 가이드라인

이 가이드는 ZKare 애플리케이션을 설정하고 사용하는 방법을 설명합니다.

## 1. 시스템 설정

### 사전 요구 사항
- Node.js v16 이상
- npm v7 이상
- 이더리움 네트워크 액세스 (로컬 개발의 경우 Hardhat 또는 Ganache)
- Metamask 지갑

### 환경 설정

1. **백엔드 환경 설정**
   - `backend` 디렉토리에 `.env` 파일이 있는지 확인하세요. 다음은 예시입니다:
   ```
   # 서버 설정
   PORT=5001
   NODE_ENV=development
   
   # 블록체인 관련 설정
   RPC_URL=http://localhost:8545
   CONTRACT_ADDRESS=0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9
   
   # ZK 프루프 관련 설정
   CIRCUIT_PATH=/Users/hwan/Projects/Zkare/circuit
   ```

2. **프론트엔드 환경 설정**
   - `frontend` 디렉토리에 `.env` 파일이 있는지 확인하세요. 다음은 예시입니다:
   ```
   # 서버 설정
   REACT_APP_API_URL=http://localhost:5001/api
   
   # 블록체인 설정
   REACT_APP_RPC_URL=http://localhost:8545
   REACT_APP_CONTRACT_ADDRESS=0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9
   
   # 개발 설정
   REACT_APP_DEBUG=false
   ```

## 2. 프로젝트 실행

### 백엔드 실행
```bash
cd backend
npm install
npm start
```

백엔드가 성공적으로 실행되면 다음과 같은 출력이 표시됩니다:
```
==========================================
  🚀 ZKare API 서버가 시작되었습니다
  🌐 서버 주소: http://localhost:5001
  🔧 환경: development
==========================================
```

### 프론트엔드 실행
```bash
cd frontend
npm install
npm start
```

프론트엔드가 성공적으로 실행되면 브라우저에서 `http://localhost:3000`으로 접속할 수 있습니다.

## 3. 기능 사용 가이드

### 환자 기능

1. **접속하기**
   - 홈페이지에서 "환자로 시작하기" 버튼을 클릭합니다.
   - Metamask 지갑을 연결하여 로그인합니다.

2. **접근 요청 관리**
   - 대시보드에서 의료 기록 접근 요청 목록을 확인합니다.
   - 각 요청에 대해 "승인" 또는 "거부" 버튼을 클릭하여 요청을 처리합니다.
   - 승인 시 Metamask를 통해 트랜잭션에 서명해야 합니다.

3. **의료 기록 관리**
   - "내 의료 기록" 탭에서 등록된 의료 기록을 확인합니다.
   - "기록 등록" 버튼을 클릭하여 새 의료 기록을 등록할 수 있습니다.

4. **증명 기록 확인**
   - "증명 기록" 탭에서 모든 생성된 증명 기록을 확인할 수 있습니다.
   - 각 증명의 상태, 생성 시간, 요청자 주소 등 상세 정보를 볼 수 있습니다.
   - "새로고침" 버튼을 클릭하여 최신 기록을 불러올 수 있습니다.

5. **혈액형 검증 정보 관리**
   - "혈액형 정보" 탭에서 본인의 혈액형 정보를 등록하고 관리할 수 있습니다.
   - 혈액형 검증 증명을 생성하여 실제 혈액형을 공개하지 않고도 특정 혈액형과의 일치 여부를 증명할 수 있습니다.

### 요청자 기능

1. **접속하기**
   - 홈페이지에서 "요청자로 시작하기" 버튼을 클릭합니다.
   - Metamask 지갑을 연결하여 로그인합니다.

2. **접근 요청 제출**
   - "환자 검색" 필드에 환자 이더리움 주소를 입력합니다.
   - "요청 목적" 필드에 접근 이유를 입력합니다.
   - "요청 제출" 버튼을 클릭하여 요청을 제출합니다.
   - Metamask를 통해 트랜잭션에 서명해야 합니다.

3. **승인된 기록 접근**
   - "승인된 요청" 탭에서 승인된 요청 목록을 확인합니다.
   - "증명 생성" 버튼을 클릭하여 ZK 증명을 생성합니다.
   - 생성된 증명으로 필요한 정보에 접근할 수 있습니다.

4. **요청 상태 관리**
   - "대기 중인 요청" 탭에서 아직 승인되지 않은 모든 요청의 상태를 확인할 수 있습니다.
   - 각 요청의 상태(대기 중, 승인됨, 거부됨)와 요청 시간을 확인할 수 있습니다.
   - "새로고침" 버튼을 클릭하여 최신 상태를 불러올 수 있습니다.

5. **혈액형 검증 요청**
   - "혈액형 검증" 탭에서 환자의 혈액형과 특정 혈액형의 일치 여부를 검증할 수 있습니다.
   - 환자 주소와 확인하고자 하는 혈액형을 선택한 후 "검증 요청" 버튼을 클릭합니다.
   - 환자가 실제 혈액형을 공개하지 않고도 일치 여부를 확인할 수 있는 영지식증명이 생성됩니다.

## 4. 문제 해결

### 연결 문제

- **백엔드 연결 확인**: 브라우저에서 `http://localhost:5001/api/status`에 접속하여 API 서버 상태를 확인합니다.
- **Metamask 연결 확인**: Metamask가 올바른 네트워크(로컬 개발의 경우 Localhost 8545)에 연결되어 있는지 확인합니다.
- **콘솔 로그 확인**: 브라우저의 개발자 도구를 열고 콘솔 탭에서 오류 메시지를 확인합니다.

### 트랜잭션 오류

- **가스 부족**: Metamask에서 가스 한도가 충분한지 확인합니다.
- **네트워크 설정**: 올바른 RPC URL이 환경 변수에 설정되어 있는지 확인합니다.
- **컨트랙트 주소**: 유효한 컨트랙트 주소가 설정되어 있는지 확인합니다.

### 증명 생성 오류

- **서킷 파일 확인**: `frontend/public/circuits` 디렉토리에 필요한 `.wasm` 및 `.zkey` 파일이 있는지 확인합니다.
- **메모리 부족**: 대용량 증명을 생성할 때 브라우저 탭이 충분한 메모리를 가지고 있는지 확인합니다.
- **서버 로그 확인**: 백엔드 터미널에서 오류 메시지를 확인합니다.

## 5. 개발 팁

- **디버그 모드 활성화**: 더 자세한 로그를 보려면 `.env` 파일에서 `DEBUG=true`를 설정합니다.
- **API 테스트**: Postman 또는 Insomnia와 같은 도구를 사용하여 API 엔드포인트를 테스트할 수 있습니다.
- **컨트랙트 상호작용**: Etherscan 또는 Remix IDE를 사용하여 스마트 컨트랙트와 직접 상호작용할 수 있습니다.
- **서킷 빌드 모니터링**: 서킷 빌드 프로세스를 모니터링하려면 `NODE_DEBUG=snarkjs`와 함께 빌드 명령을 실행합니다.
- **프론트엔드 성능 최적화**: 대규모 증명 생성 시 UI가 응답하지 않는 경우 웹 워커를 사용하여 별도의 스레드에서 처리하도록 구현을 고려합니다. 