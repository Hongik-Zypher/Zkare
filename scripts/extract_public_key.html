<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>κ°μΈν‚¤μ—μ„ κ³µκ°ν‚¤ μ¶”μ¶</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 50px auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2E7D32;
            margin-bottom: 20px;
        }
        button {
            background-color: #2E7D32;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px 5px;
        }
        button:hover {
            background-color: #1b5e20;
        }
        textarea {
            width: 100%;
            min-height: 150px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
            margin: 10px 0;
        }
        .info {
            background-color: #e3f2fd;
            padding: 15px;
            border-radius: 5px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>π”‘ κ°μΈν‚¤μ—μ„ κ³µκ°ν‚¤ μ¶”μ¶</h1>
        
        <div class="info">
            <strong>π“‹ μ‚¬μ© λ°©λ²•:</strong><br>
            1. μ•„λμ— λ°›μ€ κ°μΈν‚¤λ¥Ό λ¶™μ—¬λ„£μΌμ„Έμ”<br>
            2. "κ³µκ°ν‚¤ μ¶”μ¶" λ²„νΌμ„ ν΄λ¦­ν•μ„Έμ”<br>
            3. μ¶”μ¶λ κ³µκ°ν‚¤λ¥Ό λ³µμ‚¬ν•μ—¬ frontend/.envμ— μ„¤μ •ν•μ„Έμ”
        </div>
        
        <h3>κ°μΈν‚¤ μ…λ ¥ (Base64 λλ” PEM ν•μ‹):</h3>
        <textarea id="privateKey" placeholder="μ—¬κΈ°μ— κ°μΈν‚¤λ¥Ό λ¶™μ—¬λ„£μΌμ„Έμ”..."></textarea>
        
        <button onclick="extractPublicKey()">π”‘ κ³µκ°ν‚¤ μ¶”μ¶</button>
        <button onclick="copyPublicKey()">π“‹ κ³µκ°ν‚¤ λ³µμ‚¬</button>
        
        <h3>μ¶”μ¶λ κ³µκ°ν‚¤ (PEM ν•μ‹):</h3>
        <textarea id="publicKey" readonly placeholder="κ³µκ°ν‚¤λ¥Ό μ¶”μ¶ν•λ©΄ μ—¬κΈ°μ— ν‘μ‹λ©λ‹λ‹¤..."></textarea>
    </div>

    <script>
        let extractedPublicKey = '';

        // Base64 μΈμ½”λ”©
        function bufferToBase64(buffer) {
            const uint8Array = buffer instanceof Uint8Array ? buffer : new Uint8Array(buffer);
            const maxChunkSize = 32768;
            
            if (uint8Array.length > maxChunkSize) {
                let binary = "";
                const chunkSize = 16384;
                for (let i = 0; i < uint8Array.length; i += chunkSize) {
                    const chunk = uint8Array.subarray(i, Math.min(i + chunkSize, uint8Array.length));
                    binary += String.fromCharCode.apply(null, Array.from(chunk));
                }
                return btoa(binary);
            } else {
                return btoa(String.fromCharCode.apply(null, Array.from(uint8Array)));
            }
        }

        // Base64 λ””μ½”λ”©
        function base64ToBuffer(base64) {
            const binaryString = atob(base64);
            const len = binaryString.length;
            const bytes = new Uint8Array(len);
            for (let i = 0; i < len; i++) {
                bytes[i] = binaryString.charCodeAt(i);
            }
            return bytes;
        }

        // PEM ν•μ‹μΌλ΅ λ³€ν™
        function formatPublicKeyToPEM(publicKeyBuffer) {
            const base64 = bufferToBase64(publicKeyBuffer);
            return `-----BEGIN PUBLIC KEY-----\n${base64.match(/.{1,64}/g).join("\n")}\n-----END PUBLIC KEY-----`;
        }

        async function extractPublicKey() {
            try {
                const privateKeyInput = document.getElementById('privateKey').value.trim();
                
                if (!privateKeyInput) {
                    alert('κ°μΈν‚¤λ¥Ό μ…λ ¥ν•΄μ£Όμ„Έμ”.');
                    return;
                }

                document.getElementById('publicKey').value = 'μ¶”μ¶ μ¤‘...';

                let privateKeyBuffer;
                
                // PEM ν•μ‹μΈμ§€ Base64 ν•μ‹μΈμ§€ ν™•μΈ
                if (privateKeyInput.includes('BEGIN')) {
                    // PEM ν•μ‹: ν—¤λ”/ν‘Έν„° μ κ±°ν•κ³  Base64 λ””μ½”λ”©
                    const base64 = privateKeyInput
                        .replace('-----BEGIN PRIVATE KEY-----', '')
                        .replace('-----END PRIVATE KEY-----', '')
                        .replace(/\s/g, '');
                    privateKeyBuffer = base64ToBuffer(base64);
                } else {
                    // Base64 ν•μ‹
                    privateKeyBuffer = base64ToBuffer(privateKeyInput);
                }

                // κ°μΈν‚¤ μ„ν¬νΈ
                const privateKey = await window.crypto.subtle.importKey(
                    "pkcs8",
                    privateKeyBuffer,
                    {
                        name: "RSA-OAEP",
                        hash: "SHA-256",
                    },
                    true,
                    ["decrypt"]
                );

                // κ³µκ°ν‚¤ μ¶”μ¶ (κ°μΈν‚¤μ—μ„ κ³µκ°ν‚¤ λ¶€λ¶„λ§ μ¶”μ¶)
                // RSA ν‚¤ μμ„ λ‹¤μ‹ μƒμ„±ν•λ” λ€μ‹ , κ°μΈν‚¤μ—μ„ κ³µκ°ν‚¤λ¥Ό μ¶”μ¶
                // Web Crypto APIλ” μ§μ ‘ μ¶”μ¶μ„ μ§€μ›ν•μ§€ μ•μΌλ―€λ΅, ν‚¤ μμ„ λ‹¤μ‹ μƒμ„±ν•΄μ•Ό ν•¨
                // ν•μ§€λ§ κ°μΈν‚¤κ°€ μμΌλ©΄ κ°™μ€ ν‚¤ μμ„ μ¬μƒμ„±ν•  μ μ—†μΌλ―€λ΅,
                // λ€μ‹  κ°μΈν‚¤λ΅λ¶€ν„° κ³µκ°ν‚¤λ¥Ό μ¶”μ¶ν•λ” λ°©λ²•μ„ μ‚¬μ©

                // μ‹¤μ λ΅λ” κ°μΈν‚¤μ—μ„ μ§μ ‘ κ³µκ°ν‚¤λ¥Ό μ¶”μ¶ν•  μ μ—†μΌλ―€λ΅,
                // μ‚¬μ©μμ—κ² ν‚¤λ¥Ό λ‹¤μ‹ μƒμ„±ν•λ„λ΅ μ•λ‚΄ν•κ±°λ‚,
                // κ°μΈν‚¤ νμΌμ„ μ½μ–΄μ„ μ²λ¦¬ν•΄μ•Ό ν•¨

                alert('β οΈ Web Crypto APIλ” κ°μΈν‚¤μ—μ„ μ§μ ‘ κ³µκ°ν‚¤λ¥Ό μ¶”μ¶ν•  μ μ—†μµλ‹λ‹¤.\n\nλ€μ‹  ν‚¤ μƒμ„± νμ΄μ§€μ—μ„ λ‹¤μ‹ ν‚¤λ¥Ό μƒμ„±ν•μ‹κ±°λ‚, ν‚¤ μƒμ„± μ‹ κ³µκ°ν‚¤λ„ ν•¨κ» μ €μ¥ν•μ„Έμ”.');
                
                // λ€μ•: ν‚¤ μμ„ λ‹¤μ‹ μƒμ„± (ν•μ§€λ§ κ°™μ€ ν‚¤λ” μ•„λ‹)
                const keyPair = await window.crypto.subtle.generateKey(
                    {
                        name: "RSA-OAEP",
                        modulusLength: 2048,
                        publicExponent: new Uint8Array([1, 0, 1]),
                        hash: "SHA-256",
                    },
                    true,
                    ["encrypt", "decrypt"]
                );

                const publicKeyBuffer = await window.crypto.subtle.exportKey("spki", keyPair.publicKey);
                extractedPublicKey = formatPublicKeyToPEM(publicKeyBuffer);

                document.getElementById('publicKey').value = extractedPublicKey;
                
                alert('β οΈ μ£Όμ: μƒλ΅ μƒμ„±λ ν‚¤ μμ…λ‹λ‹¤.\nμ›λ κ°μΈν‚¤μ™€λ” λ‹¤λ¥Έ ν‚¤μ…λ‹λ‹¤.\n\nμ›λ ν‚¤ μμ κ³µκ°ν‚¤κ°€ ν•„μ”ν•λ©΄ ν‚¤ μƒμ„± νμ΄μ§€μ—μ„ λ‹¤μ‹ μƒμ„±ν•μ„Έμ”.');

            } catch (error) {
                console.error('κ³µκ°ν‚¤ μ¶”μ¶ μ¤λ¥:', error);
                alert('β κ³µκ°ν‚¤ μ¶”μ¶ μ‹¤ν¨: ' + error.message);
            }
        }

        function copyPublicKey() {
            if (!extractedPublicKey) {
                alert('λ¨Όμ € κ³µκ°ν‚¤λ¥Ό μ¶”μ¶ν•΄μ£Όμ„Έμ”.');
                return;
            }
            
            const textarea = document.getElementById('publicKey');
            textarea.select();
            document.execCommand('copy');
            alert('β… κ³µκ°ν‚¤κ°€ ν΄λ¦½λ³΄λ“μ— λ³µμ‚¬λμ—μµλ‹λ‹¤!');
        }
    </script>
</body>
</html>

